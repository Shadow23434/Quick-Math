<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<StackPane xmlns="http://javafx.com/javafx/21"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.mathspeed.controller.GameplayController"
           prefHeight="720"
           prefWidth="480">

    <!-- Main Game View -->
    <VBox styleClass="gameplay-view"
          stylesheets="@../../css/gameplay.css">

        <!-- Header -->
        <HBox spacing="20" alignment="CENTER" styleClass="gameplay-header">
            <VBox.margin>
                <Insets top="5" right="10" left="10" bottom="5"/>
            </VBox.margin>
            <padding>
                <Insets top="5" right="10" bottom="5" left="10"/>
            </padding>

            <VBox alignment="CENTER" spacing="1" styleClass="score-container">
                <Label fx:id="playerNameLabel" text="You" styleClass="player-label"/>
                <Label fx:id="playerScoreLabel" text="0" styleClass="score-text"/>
            </VBox>

            <VBox alignment="CENTER" spacing="1" styleClass="timer-container">
                <HBox alignment="CENTER" spacing="2">
                    <FontIcon iconLiteral="fas-hourglass-end" styleClass="timer-icon"/>
                    <Label fx:id="timerLabel" text="30s" styleClass="timer-text"/>
                </HBox>
            </VBox>

            <VBox alignment="CENTER" spacing="1" styleClass="score-container">
                <Label fx:id="opponentNameLabel" text="Opponent" styleClass="opponent-label"/>
                <Label fx:id="opponentScoreLabel" text="0" styleClass="score-text"/>
            </VBox>
        </HBox>

        <!-- Round and Level Info -->
        <HBox spacing="15" alignment="CENTER" styleClass="game-info-container">
            <VBox.margin>
                <Insets top="3" right="10" left="10" bottom="3"/>
            </VBox.margin>

            <VBox alignment="CENTER" spacing="1" styleClass="round-container">
                <Label text="Vòng" styleClass="info-label"/>
                <Label fx:id="roundLabel" text="1" styleClass="round-text"/>
            </VBox>

            <Separator orientation="VERTICAL" styleClass="info-separator"/>

            <VBox alignment="CENTER" spacing="1" styleClass="level-container">
                <Label text="Mức" styleClass="info-label"/>
                <Label fx:id="levelLabel" text="1" styleClass="level-text"/>
            </VBox>
        </HBox>

        <!-- Target Number -->
        <VBox spacing="2" alignment="CENTER">
            <VBox.margin>
                <Insets top="3" right="10" left="10" bottom="3"/>
            </VBox.margin>
            <Label text="Mục tiêu" styleClass="target-label"/>
            <Label fx:id="targetLabel" text="42" styleClass="target-number"/>
        </VBox>

        <!-- Game Status -->
        <VBox alignment="CENTER">
            <VBox.margin>
                <Insets top="2" right="10" left="10" bottom="2"/>
            </VBox.margin>
            <Label fx:id="gameStatusLabel"
                   text="Waiting for game to start..."
                   styleClass="game-status-text"
                   wrapText="true"
                   alignment="CENTER"/>
        </VBox>

        <!-- Expression Input -->
        <VBox spacing="4" alignment="CENTER" styleClass="input-section">
            <VBox.margin>
                <Insets top="3" right="10" left="10" bottom="3"/>
            </VBox.margin>

            <VBox styleClass="expression-container" alignment="CENTER" prefHeight="45">
                <padding>
                    <Insets top="5" right="8" bottom="5" left="8"/>
                </padding>
                <Label fx:id="expressionLabel"
                       text=""
                       styleClass="expression-text"
                       wrapText="true"
                       alignment="CENTER"/>
            </VBox>

            <!-- Buttons -->
            <HBox spacing="10" alignment="CENTER" styleClass="button-row">
                <Button fx:id="submitButton"
                        text="Nộp"
                        styleClass="submit-button"
                        prefWidth="100"
                        prefHeight="36"
                        onAction="#handleSubmit"/>

                <Button fx:id="exitButton"
                        text="Thoát"
                        styleClass="exit-button"
                        prefWidth="100"
                        prefHeight="36"
                        onAction="#handleExit"/>
            </HBox>
        </VBox>

        <!-- Operators -->
        <VBox spacing="2" alignment="CENTER">
            <VBox.margin>
                <Insets top="2" right="10" left="10" bottom="2"/>
            </VBox.margin>

            <HBox spacing="4" alignment="CENTER" styleClass="operators-row">
                <Button text="+" styleClass="operator-button" prefWidth="38" prefHeight="35" onAction="#handleOperatorInput"/>
                <Button text="-" styleClass="operator-button" prefWidth="38" prefHeight="35" onAction="#handleOperatorInput"/>
                <Button text="×" styleClass="operator-button" prefWidth="38" prefHeight="35" onAction="#handleOperatorInput"/>
                <Button text="÷" styleClass="operator-button" prefWidth="38" prefHeight="35" onAction="#handleOperatorInput"/>

                <Separator orientation="VERTICAL" styleClass="operator-separator"/>

                <Button text="(" styleClass="bracket-button" prefWidth="38" prefHeight="35" onAction="#handleBracketInput"/>
                <Button text=")" styleClass="bracket-button" prefWidth="38" prefHeight="35" onAction="#handleBracketInput"/>
            </HBox>
        </VBox>

        <!-- Numbers -->
        <VBox spacing="2" alignment="CENTER" VBox.vgrow="ALWAYS">
            <VBox.margin>
                <Insets top="2" right="10" left="10" bottom="10"/>
            </VBox.margin>

            <GridPane hgap="3" vgap="3" alignment="TOP_CENTER" styleClass="numbers-grid">
                <Button text="1" styleClass="number-button" GridPane.rowIndex="0" GridPane.columnIndex="0" onAction="#handleNumberInput"/>
                <Button text="2" styleClass="number-button" GridPane.rowIndex="0" GridPane.columnIndex="1" onAction="#handleNumberInput"/>
                <Button text="3" styleClass="number-button" GridPane.rowIndex="0" GridPane.columnIndex="2" onAction="#handleNumberInput"/>
                <Button text="4" styleClass="number-button" GridPane.rowIndex="0" GridPane.columnIndex="3" onAction="#handleNumberInput"/>
                <Button text="5" styleClass="number-button" GridPane.rowIndex="0" GridPane.columnIndex="4" onAction="#handleNumberInput"/>

                <Button text="6" styleClass="number-button" GridPane.rowIndex="1" GridPane.columnIndex="0" onAction="#handleNumberInput"/>
                <Button text="7" styleClass="number-button" GridPane.rowIndex="1" GridPane.columnIndex="1" onAction="#handleNumberInput"/>
                <Button text="8" styleClass="number-button" GridPane.rowIndex="1" GridPane.columnIndex="2" onAction="#handleNumberInput"/>
                <Button text="9" styleClass="number-button" GridPane.rowIndex="1" GridPane.columnIndex="3" onAction="#handleNumberInput"/>

                <Button fx:id="backspaceButton"
                        styleClass="backspace-button"
                        prefWidth="60"
                        prefHeight="60"
                        GridPane.rowIndex="1"
                        GridPane.columnIndex="4"
                        onAction="#handleBackspace">
                    <graphic>
                        <FontIcon iconLiteral="fas-backspace"/>
                    </graphic>
                </Button>
            </GridPane>
        </VBox>
    </VBox>

    <!-- Countdown Overlay -->
    <StackPane fx:id="countdownOverlay"
               styleClass="countdown-overlay"
               visible="false">

        <VBox fx:id="countdownContainer"
              alignment="CENTER"
              spacing="20"
              styleClass="countdown-container">

            <Label fx:id="countdownMessageLabel"
                   text="Trận đấu sắp bắt đầu!"
                   styleClass="countdown-message"/>

            <Label fx:id="countdownLabel"
                   text="5"
                   styleClass="countdown-number"/>

        </VBox>
    </StackPane>

</StackPane>