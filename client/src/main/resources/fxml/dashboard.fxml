<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<?import javafx.scene.image.ImageView?>
<?import javafx.scene.shape.Rectangle?>
<?import javafx.scene.shape.SVGPath?>
<VBox xmlns="http://javafx.com/javafx/21"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.mathspeed.controller.DashboardController"
      styleClass="container">
    <!-- Header Section (Fixed Position at Top) -->
    <BorderPane styleClass="header-section" VBox.vgrow="NEVER" StackPane.alignment="TOP_CENTER">
        <left>
            <!-- Left: User Avatar + User Info -->
            <HBox alignment="CENTER_LEFT" spacing="10">
                <!-- Logo ImageView in place of Avatar Label -->
                <ImageView fx:id="logoImageView" fitWidth="40" fitHeight="40" preserveRatio="true" styleClass="avatar-image">
                    <image>
                        <javafx.scene.image.Image url="https://i.pravatar.cc/150?img=12"/>
                    </image>
                    <clip>
                        <javafx.scene.shape.Circle radius="20" centerX="20" centerY="20"/>
                    </clip>
                </ImageView>
                <VBox spacing="2" alignment="CENTER_LEFT">
                    <Label fx:id="userGreetingLabel" text="Hi, Player" styleClass="user-greeting"/>
                    <Label fx:id="userEmailLabel" text="player@null.com" styleClass="user-email"/>
                </VBox>
            </HBox>
        </left>

        <center>
            <!-- Spacer -->
            <Region HBox.hgrow="ALWAYS"/>
        </center>

        <right>
            <!-- Right: Action Icons -->
            <HBox alignment="CENTER_RIGHT" spacing="10">
                <Button fx:id="searchButton" styleClass="icon-button" onAction="#handleSearch">
                    <graphic>
                        <FontIcon iconLiteral="fas-search" styleClass="header-icon"/>
                    </graphic>
                </Button>

                <Button fx:id="notificationButton" styleClass="icon-button" onAction="#handleNotifications">
                    <graphic>
                        <FontIcon iconLiteral="fas-bell" styleClass="header-icon"/>
                    </graphic>
                </Button>
                <Button fx:id="reloadButton"
                        text="ðŸ”„"
                        onAction="#handleReload"
                        styleClass="icon-button">
                    <tooltip>
                        <Tooltip text="Reload (F5)"/>
                    </tooltip>
                </Button>
            </HBox>
        </right>
    </BorderPane>

    <!-- Main Content Scrolls Below Header -->
    <ScrollPane fitToHeight="true"
                hbarPolicy="NEVER"
                vbarPolicy="NEVER"
                styleClass="dashboard-scroll-pane"
                pickOnBounds="false"
                VBox.vgrow="ALWAYS">
        <AnchorPane AnchorPane.topAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0">
            <BorderPane layoutX="10" layoutY="10" >
                <center>
                    <!-- Main Content -->
                    <VBox spacing="20" style="-fx-padding: 0 0 20 0">
                        <!-- User Stats Card -->
                        <VBox styleClass="stats-card">
                            <!-- Stats -->
                            <BorderPane>
                                <padding>
                                    <Insets top="10" right="10" bottom="20" left="10"/>
                                </padding>
                                <left>
                                    <VBox alignment="CENTER" spacing="10">
                                        <Label text="My Quiz" styleClass="stat-label"/>
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <StackPane styleClass="stat-icon-bg">
                                                <FontIcon iconLiteral="fas-clipboard-list" styleClass="stat-icon"/>
                                            </StackPane>
                                            <Label text="24" styleClass="stat-text"/>
                                        </HBox>
                                    </VBox>
                                </left>

                                <center>
                                    <VBox alignment="CENTER" spacing="10">
                                        <Label text="Plays" styleClass="stat-label"/>
                                        <HBox alignment="CENTER" spacing="10">
                                            <StackPane styleClass="stat-icon-bg">
                                                <FontIcon iconLiteral="fas-play-circle" styleClass="stat-icon"/>
                                            </StackPane>
                                            <Label text="43" styleClass="stat-text"/>
                                        </HBox>
                                    </VBox>
                                </center>

                                <right>
                                    <VBox alignment="CENTER" spacing="10">
                                        <Label text="Wins" styleClass="stat-label"/>
                                        <HBox alignment="CENTER_RIGHT" spacing="10">
                                            <StackPane styleClass="stat-icon-bg">
                                                <FontIcon iconLiteral="fas-trophy" styleClass="stat-icon"/>
                                            </StackPane>
                                            <Label text="14" styleClass="stat-text"/>
                                        </HBox>
                                    </VBox>
                                </right>
                            </BorderPane>

                            <!-- Find Friend Card -->
                            <VBox spacing="15" styleClass="find-friend-card">
                                <StackPane pickOnBounds="false">
                                    <!-- Wave layers - back to front -->
                                    <Region styleClass="wave1" mouseTransparent="true" StackPane.alignment="BOTTOM_RIGHT"/>
                                    <Region styleClass="wave2" mouseTransparent="true" StackPane.alignment="BOTTOM_RIGHT"/>

                                    <!-- Content on top -->
                                    <VBox spacing="10" style="-fx-padding: 20 20;" StackPane.alignment="TOP_LEFT">
                                        <Label text="Play brain games together with your friends now" styleClass="find-friend-label" wrapText="true" maxWidth="200"/>
                                        <Button fx:id="findFriendsButton"
                                                text="Find Friends"
                                                styleClass="primary-button"
                                                onAction="#handleFriends"
                                                maxWidth="120"/>
                                    </VBox>
                                </StackPane>
                            </VBox>
                        </VBox>

                        <!-- Discover Quiz -->
                        <VBox spacing="10">
                            <!-- Section Header -->
                            <HBox maxWidth="330">
                                <Label text="Discover Quiz" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Hyperlink fx:id="seeAllQuizLink" text="See All"
                                           onAction="#handleLibrary"
                                           styleClass="hyper-link"
                                           contentDisplay="RIGHT">
                                    <graphic>
                                        <FontIcon iconLiteral="fas-chevron-right" styleClass="see-all-icon"/>
                                    </graphic>
                                </Hyperlink>
                            </HBox>

                            <!-- Quiz Carousel -->
                            <StackPane fx:id="quizCarouselPane"
                                       maxWidth="630"
                                       prefWidth="630"
                                       alignment="CENTER_LEFT"/>
                        </VBox>

                        <!-- Online Friends -->
                        <VBox spacing="10">
                            <HBox maxWidth="330">
                                <Label text="Online Friends" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Hyperlink fx:id="seeAllFriendsLink" text="See All"
                                           onAction="#handleFriends"
                                           styleClass="hyper-link"
                                           contentDisplay="RIGHT">
                                    <graphic>
                                        <FontIcon iconLiteral="fas-chevron-right" styleClass="see-all-icon"/>
                                    </graphic>
                                </Hyperlink>
                            </HBox>

                            <!-- Friends Carousel -->
                            <StackPane fx:id="friendsCarouselPane"
                                       maxWidth="630"
                                       prefWidth="630"
                                       alignment="CENTER_LEFT"/>
                        </VBox>

                        <!-- Loading Indicator (hidden by default) -->
                        <ProgressIndicator fx:id="loadingIndicator"
                                           visible="false"
                                           managed="false"
                                           maxWidth="40"
                                           maxHeight="40"/>
                    </VBox>
                </center>

                <bottom>

                </bottom>
            </BorderPane>
        </AnchorPane>
    </ScrollPane>

    <!-- Bottom AppBar (Fixed Position) with Floating Join Quiz Button -->
    <StackPane VBox.vgrow="NEVER" styleClass="bottom-appbar-stack">
        <!-- AppBar Background and Menu -->
        <HBox spacing="20" alignment="CENTER" styleClass="bottom-appbar">
            <!-- Home -->
            <VBox alignment="CENTER" spacing="4" styleClass="bottom-appbar-item">
                <FontIcon fx:id="homeIcon" iconLiteral="far-envelope-open" styleClass="bottom-appbar-icon"/>
                <Label fx:id="homeLabel" text="Home" styleClass="bottom-appbar-label"/>
            </VBox>
            <!-- Library -->
            <VBox alignment="CENTER" spacing="4" styleClass="bottom-appbar-item">
                <FontIcon fx:id="libraryIcon" iconLiteral="far-copy" styleClass="bottom-appbar-icon"/>
                <Label fx:id="libraryLabel" text="Library" styleClass="bottom-appbar-label"/>
            </VBox>
            <!-- Spacer for Floating Button -->
            <Region minWidth="60" maxWidth="60"/>
            <!-- Friends -->
            <VBox alignment="CENTER" spacing="4" styleClass="bottom-appbar-item">
                <FontIcon fx:id="friendsIcon" iconLiteral="fas-user-friends" styleClass="bottom-appbar-icon"/>
                <Label fx:id="friendsLabel" text="Friends" styleClass="bottom-appbar-label"/>
            </VBox>
            <!-- Profile -->
            <VBox alignment="CENTER" spacing="4" styleClass="bottom-appbar-item">
                <FontIcon fx:id="profileIcon" iconLiteral="fas-user" styleClass="bottom-appbar-icon"/>
                <Label fx:id="profileLabel" text="Profile" styleClass="bottom-appbar-label"/>
            </VBox>
        </HBox>
        <!-- Floating Join Quiz Button -->
        <Button fx:id="joinQuizButton" styleClass="floating-quiz-button" StackPane.alignment="CENTER">
            <graphic>
                <FontIcon iconLiteral="fas-play" styleClass="floating-quiz-icon"/>
            </graphic>
            <tooltip>
                <Tooltip text="Join Quiz"/>
            </tooltip>
        </Button>
        <!-- Optional: Add a handle bar below for mobile look -->
        <Rectangle width="60" height="6" arcWidth="6" arcHeight="6" fill="#23262F" opacity="0.15" StackPane.alignment="BOTTOM_CENTER" styleClass="bottom-appbar-handle"/>
    </StackPane>
</VBox>
