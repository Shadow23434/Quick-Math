<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<StackPane xmlns="http://javafx.com/javafx/21"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.mathspeed.controller.RegisterController"
           styleClass="container">

    <!-- ScrollPane to enable scrolling -->
    <ScrollPane fitToWidth="true"
                fitToHeight="true"
                hbarPolicy="NEVER"
                vbarPolicy="NEVER"
                styleClass="register-scroll-pane"
                pickOnBounds="false">

        <BorderPane pickOnBounds="false">
            <!-- Main Content -->
            <top>
                <VBox alignment="TOP_CENTER"
                      spacing="20"
                      pickOnBounds="false">

                    <padding>
                        <Insets top="40" right="20" bottom="20" left="20"/>
                    </padding>

                    <!-- Title -->
                    <VBox alignment="CENTER" spacing="10" pickOnBounds="false">
                        <Label text="Register New Account" styleClass="title"/>
                        <Label text="Create an account to join the quiz" styleClass="subtitle"/>
                    </VBox>

                    <!-- Register Form -->
                    <VBox spacing="15" styleClass="form-container">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>

                        <!-- Username Field -->
                        <VBox spacing="5">
                            <Label text="Username" styleClass="field-label"/>

                            <StackPane>
                                <TextField fx:id="usernameField"
                                           promptText="Enter username"
                                           styleClass="text-field"
                                           StackPane.alignment="CENTER_LEFT"/>

                                <!-- Clear button -->
                                <HBox alignment="CENTER_RIGHT"
                                      spacing="5"
                                      StackPane.alignment="CENTER_RIGHT"
                                      pickOnBounds="false">

                                    <Button fx:id="clearUsernameButton"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            visible="false"
                                            managed="false"
                                            onAction="#handleClearUsername">
                                        <tooltip>
                                            <Tooltip text="Clear username"/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </StackPane>
                        </VBox>

                        <!-- Email Field -->
                        <VBox spacing="5">
                            <Label text="Email" styleClass="field-label"/>

                            <StackPane>
                                <TextField fx:id="emailField"
                                           promptText="Enter email"
                                           styleClass="text-field"
                                           StackPane.alignment="CENTER_LEFT"/>

                                <!-- Clear button -->
                                <HBox alignment="CENTER_RIGHT"
                                      spacing="5"
                                      StackPane.alignment="CENTER_RIGHT"
                                      pickOnBounds="false">

                                    <Button fx:id="clearEmailButton"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            visible="false"
                                            managed="false"
                                            onAction="#handleClearEmail">
                                        <tooltip>
                                            <Tooltip text="Clear email"/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </StackPane>
                        </VBox>

                        <!-- Date of Birth Selector -->
                        <VBox spacing="5">
                            <Label text="Date of Birth" styleClass="field-label"/>
                            <DatePicker fx:id="dateOfBirthPicker"
                                       promptText="Select date of birth"
                                       styleClass="date-picker"
                                       maxWidth="Infinity"
                                       editable="false"/>
                        </VBox>

                        <!-- Country Selector -->
                        <VBox spacing="5">
                            <Label text="Country" styleClass="field-label"/>
                            <ComboBox fx:id="countryComboBox"
                                     promptText="Select your country"
                                     styleClass="combo-box"
                                     maxWidth="Infinity"/>
                        </VBox>

                        <!-- Password Field -->
                        <VBox spacing="5">
                            <HBox alignment="CENTER_LEFT" spacing="5">
                                <Label text="Password" styleClass="field-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <!-- Password strength indicator -->
                                <Label fx:id="passwordStrengthLabel"
                                       text=""
                                       styleClass="password-strength-label"
                                       visible="false"
                                       managed="false"/>
                            </HBox>

                            <StackPane>
                                <!-- Password Field (Hidden) -->
                                <PasswordField fx:id="passwordHiddenField"
                                               promptText="Enter password"
                                               styleClass="password-hidden-field"
                                               StackPane.alignment="CENTER_LEFT"/>

                                <!-- Visible Text Field (When toggled) -->
                                <TextField fx:id="passwordVisibleField"
                                           promptText="Enter password"
                                           styleClass="password-visible-field"
                                           visible="false"
                                           managed="false"
                                           StackPane.alignment="CENTER_LEFT"/>

                                <!-- Toggle Button -->
                                <HBox alignment="CENTER_RIGHT"
                                      spacing="5"
                                      StackPane.alignment="CENTER_RIGHT"
                                      pickOnBounds="false">

                                    <!-- Clear button -->
                                    <Button fx:id="clearPasswordButton"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            visible="false"
                                            managed="false"
                                            onAction="#handleClearPassword">
                                        <tooltip>
                                            <Tooltip text="Clear password"/>
                                        </tooltip>
                                    </Button>

                                    <!-- Toggle visibility button -->
                                    <Button fx:id="toggleShowPassword"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            onAction="#handleTogglePassword">
                                        <tooltip>
                                            <Tooltip text="Show/Hide password"/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </StackPane>

                            <!-- Password hint/error message -->
                            <Label fx:id="passwordHintLabel"
                                   text=""
                                   styleClass="password-hint"
                                   wrapText="true"
                                   visible="false"
                                   managed="false"/>
                        </VBox>

                        <!-- Confirm Password Field -->
                        <VBox spacing="5">
                            <Label text="Confirm Password" styleClass="field-label"/>

                            <StackPane>
                                <!-- Password Field (Hidden) -->
                                <PasswordField fx:id="confirmPasswordHiddenField"
                                               promptText="Re-enter password"
                                               styleClass="password-hidden-field"
                                               StackPane.alignment="CENTER_LEFT"/>

                                <!-- Visible Text Field (When toggled) -->
                                <TextField fx:id="confirmPasswordVisibleField"
                                           promptText="Re-enter password"
                                           styleClass="password-visible-field"
                                           visible="false"
                                           managed="false"
                                           StackPane.alignment="CENTER_LEFT"/>

                                <!-- Toggle Button -->
                                <HBox alignment="CENTER_RIGHT"
                                      spacing="5"
                                      StackPane.alignment="CENTER_RIGHT"
                                      pickOnBounds="false">

                                    <!-- Clear button -->
                                    <Button fx:id="clearConfirmPasswordButton"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            visible="false"
                                            managed="false"
                                            onAction="#handleClearConfirmPassword">
                                        <tooltip>
                                            <Tooltip text="Clear password"/>
                                        </tooltip>
                                    </Button>

                                    <!-- Toggle visibility button -->
                                    <Button fx:id="toggleShowConfirmPassword"
                                            styleClass="password-action-button"
                                            focusTraversable="false"
                                            onAction="#handleToggleConfirmPassword">
                                        <tooltip>
                                            <Tooltip text="Show/Hide password"/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </StackPane>

                            <!-- Confirm password hint/error message -->
                            <Label fx:id="confirmPasswordHintLabel"
                                   text=""
                                   styleClass="password-hint"
                                   wrapText="true"
                                   visible="false"
                                   managed="false"/>
                        </VBox>

                        <!-- Terms & Conditions -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <StackPane>
                                <CheckBox fx:id="termsCheckBox" text="I agree to Terms &amp; Conditions"/>
                                <Label fx:id="checkIconLabel"
                                       managed="false"
                                       mouseTransparent="true"
                                       visible="false"
                                       StackPane.alignment="CENTER_LEFT">
                                    <padding>
                                        <Insets left="4" top="18"/>
                                    </padding>
                                </Label>
                            </StackPane>
                        </HBox>

                        <!-- Error Message -->
                        <Label fx:id="errorLabel"
                               styleClass="error-label"
                               wrapText="true"
                               textAlignment="CENTER"
                               alignment="CENTER"
                               maxWidth="Infinity"
                               visible="false"
                               managed="false"/>
                    </VBox>

                    <!-- Register Button -->
                    <Button fx:id="registerButton"
                            text="Register Now"
                            onAction="#handleRegister"
                            styleClass="primary-button"
                            defaultButton="true"
                            maxWidth="Infinity">
                    </Button>

                    <!-- Loading Indicator -->
                    <ProgressIndicator fx:id="loadingIndicator"
                                       visible="false"
                                       managed="false"
                                       prefWidth="30"
                                       prefHeight="30"/>
                </VBox>
            </top>

            <!-- Login Link at Bottom -->
            <bottom>
                <HBox spacing="5" alignment="CENTER">
                    <padding>
                        <Insets top="20" right="20" bottom="30" left="20"/>
                    </padding>
                    <Text styleClass="register-text">Already have an account?</Text>
                    <Hyperlink text="Sign In Now"
                               onAction="#handleLogin"
                               styleClass="hyper-link"/>
                </HBox>
            </bottom>
        </BorderPane>
    </ScrollPane>

    <!-- Floating Reload Button (Dev Mode) -->
    <Button fx:id="reloadButton"
            text="🔄"
            onAction="#handleReload"
            styleClass="reload-button, floating-button"
            StackPane.alignment="TOP_RIGHT">
        <StackPane.margin>
            <Insets top="15" right="15"/>
        </StackPane.margin>
        <tooltip>
            <Tooltip text="Reload (F5)"/>
        </tooltip>
    </Button>

</StackPane>
